{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="fixed top-4 right-4 z-50 space-y-3">
            {% for category, message in messages %}
                <div class="flash-message bg-gray-700 border-l-4 {% if category == 'success' %}border-lime-400{% elif category == 'error' %}border-red-400{% elif category == 'warning' %}border-yellow-400{% elif category == 'info' %}border-blue-400{% else %}border-gray-400{% endif %} p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 ease-in-out" data-category="{{ category }}">
                    <div class="flex items-start justify-between">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 mr-3">
                                {% if category == 'success' %}
                                    <svg class="h-5 w-5 text-lime-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                {% elif category == 'error' %}
                                    <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                {% elif category == 'warning' %}
                                    <svg class="h-5 w-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                {% elif category == 'info' %}
                                    <svg class="h-5 w-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                {% else %}
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                {% endif %}
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-white leading-5">{{ message }}</p>
                            </div>
                        </div>
                        <button type="button" class="close-flash ml-3 flex-shrink-0 text-gray-400 hover:text-gray-200 transition-colors duration-200" onclick="dismissFlashMessage(this)">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <!-- Progress bar for visual timeout indicator -->
                    <div class="mt-3 w-full bg-gray-600 rounded-full h-1 overflow-hidden">
                        <div class="progress-bar h-full {% if category == 'success' %}bg-lime-400{% elif category == 'error' %}bg-red-400{% elif category == 'warning' %}bg-yellow-400{% elif category == 'info' %}bg-blue-400{% else %}bg-gray-400{% endif %} transition-all ease-linear"></div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <script>
        // Flash message dismiss function
        function dismissFlashMessage(button) {
            const message = button.closest('.flash-message');
            message.style.transform = 'translateX(100%)';
            message.style.opacity = '0';
            setTimeout(() => {
                if (message.parentNode) {
                    message.remove();
                }
            }, 300);
        }

        // Auto-dismiss flash messages
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            
            flashMessages.forEach(function(message) {
                const category = message.dataset.category;
                const progressBar = message.querySelector('.progress-bar');
                
                // Set timeout duration based on category
                let timeout = 5000; // default 5 seconds
                if (category === 'error') {
                    timeout = 8000; // Error messages stay longer
                } else if (category === 'success') {
                    timeout = 4000; // Success messages dismiss quicker
                } else if (category === 'warning') {
                    timeout = 6000; // Warning messages stay a bit longer
                } else if (category === 'info') {
                    timeout = 5000; // Info messages normal duration
                }
                
                // Animate progress bar
                if (progressBar) {
                    progressBar.style.width = '100%';
                    progressBar.style.transitionDuration = timeout + 'ms';
                    
                    // Start the countdown animation
                    setTimeout(() => {
                        progressBar.style.width = '0%';
                    }, 100);
                }
                
                // Auto-dismiss after timeout
                setTimeout(function() {
                    if (message.parentNode) {
                        message.style.transform = 'translateX(100%)';
                        message.style.opacity = '0';
                        
                        setTimeout(function() {
                            if (message.parentNode) {
                                message.remove();
                            }
                        }, 300);
                    }
                }, timeout);
                
                // Pause auto-dismiss on hover
                message.addEventListener('mouseenter', function() {
                    progressBar.style.animationPlayState = 'paused';
                });
                
                message.addEventListener('mouseleave', function() {
                    progressBar.style.animationPlayState = 'running';
                });
            });
        });
        </script>
    {% endif %}
{% endwith %}